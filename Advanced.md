# Расширенное руководство

## Содержание

1. [Описание](#описание)
2. [Бланки ответов](#бланки-ответов)
    1. [Преамбула](#преамбула)
    1. [Титульный лист](#титульный-лист)
    1. [Названия задач и таблицы с баллами](#названия-задач-и-таблицы-с-баллами)
        1. [Названия задач](#названия-задач)
        1. [Таблицы с баллами](#таблицы-с-баллами)
    1. [Поля для ответов](#поля-для-ответов)
        1. [Обычные задачи](#обычные-задачи)
        1. [Задачи по органике](#задачи-по-органике)
3. [Файл с задачами](#файл-с-задачами)
    1. [Основной файл](#основной-файл)
        1. [Преамбула](#d0bfd180d0b5d0b0d0bcd0b1d183d0bbd0b0-1)
        1. [Титульный лист](#d182d0b8d182d183d0bbd18cd0bdd18bd0b9-d0bbd0b8d181d182-1)
        1. [Регламент, периодическая таблица, задачи](#регламент-периодическая-таблица-задачи)
    1. [Файл с самой задачей](#файл-с-самой-задачей)
        1. [Название задачи](#название-задачи)
        1. [Таблица с баллами](#таблица-с-баллами)
        1. [Задачи с подзадачами](#задачи-с-подзадачами)
        1. [Таблицы в задаче](#таблицы-в-задаче)
        1. [Изображения в задаче](#изображения-в-задаче)
        1. [Единицы измерения](#единицы-измерения)
        1. [Химические формулы](#химические-формулы)
        1. [Листы](#листы)
        1. [Прочее](#прочее)
4. [Файл с решениями](#файл-с-решениями)
    1. [Основной файл](#d0bed181d0bdd0bed0b2d0bdd0bed0b9-d184d0b0d0b9d0bb-1)
        1. [Преамбула](#d0bfd180d0b5d0b0d0bcd0b1d183d0bbd0b0-2)
        1. [Титульный лист](#d182d0b8d182d183d0bbd18cd0bdd18bd0b9-d0bbd0b8d181d182-2)
        1. [Регламент, периодическая таблица, задачи](#d180d0b5d0b3d0bbd0b0d0bcd0b5d0bdd182-d0bfd0b5d180d0b8d0bed0b4d0b8d187d0b5d181d0bad0b0d18f-d182d0b0d0b1d0bbd0b8d186d0b0-d0b7d0b0d0b4d0b0d187d0b8-1)
    1. [Файл с самим решением](#файл-с-самим-решением)
        1. [Название задачи](#d0bdd0b0d0b7d0b2d0b0d0bdd0b8d0b5-d0b7d0b0d0b4d0b0d187d0b8-1)
        1. [Таблица с баллами](#d182d0b0d0b1d0bbd0b8d186d0b0-d181-d0b1d0b0d0bbd0bbd0b0d0bcd0b8-1)
        1. [Боксы с решением](#боксы-с-решением)
            1. [Обычные задачи](#d0bed0b1d18bd187d0bdd18bd0b5-d0b7d0b0d0b4d0b0d187d0b8-1)
            1. [Задачи по органике](#d0b7d0b0d0b4d0b0d187d0b8-d0bfd0be-d0bed180d0b3d0b0d0bdd0b8d0bad0b5-1)
4. [Примечания](#примечания)

# Описание

Ниже --- гайд по тому, как писать код для бланка, файла с задачами и файла с решениями. Из важного --- компилировать надо не с помощью pdfLaTex, а XeLaTeX.

Если что-то не работает или работает не так, как должно, прошу написать в телеграм (@DrMrmld), на почту (zhaksylykov.azamat.n@gmail.com) или в Slack --- как удобно.

Если с латехом не сильно знакомы, можно посетить [эту тему](https://ask.bc-pf.org/t/kak-pisat-formuly-yazyk-razmetki-latex/1296) на форуме Спроси.

# Бланки ответов

## Преамбула

В преамбуле ничего особенного нет. `title`, `author`, `date` можно задавать любыми, они нигде не высвечиваются. Только вместо стандартного класса `article` у нас свой класс, в котором сохранены все нужные пакеты и команды, поэтому самое важное в преамбуле --- `\documentclass{qazcho_blank}`. В преамбуле ничего редактировать не надо.

## Титульный лист

Титульный лист создается командой `\titlepage{}{}{}{}`. Она принимает 4 аргумента: этап олимпиады, год, класс и название файла.

## Названия задач и таблицы с баллами

### Названия задач

Для названий задач используется команда `\problem{}`. У нее один аргумент --- название задачи. Номер задачи включать не надо, он вставится автоматически.

### Таблицы с баллами

Для таблицы с баллами есть команды `\ProblemPoints[Число от 1 до 7]`. Число в названии команды --- количество пунктов в задаче. К примеру команда `\ProblemPointsSeven{2}{3}{3}{4}{4}{2}{3}{21}{8}` создаст таблицу для задачи с 7 пунктами. Первые 7 аргументов --- баллы за каждый пункт, 8-й аргумент --- общая сумма баллов, 9-й аргумент --- вес задачи. Во всех этих командах аргументы --- это просто значения в нижней строке таблицы по порядку.

Если в задаче больше 7 пунктов или задача разделена на подзадачи, надо делать таблицу вручную. Но чтобы на это не уходило много времени, можно просто сгенерировать код для нужной таблицы. Для этого создаем аккаунт на [Replit](https://replit.com/) и переходим по [ссылке](https://replit.com/join/fqvczrwown-drmrmld), чтобы открылся доступ на редактирование репла.

Редактировать надо и можно только две строки --- определение `table_headers` и `table_values`. Первое --- лист с названиями полей таблицы, второе --- записи этой полей. После того, как отредактировали эти листы, надо нажать "Run" (`Cmd/Ctrl+Enter`)[^1]. Во вкладке Files будет файл `problem-points-table.tex`, в нем код, который надо просто скопировать и вставить после названия задачи в латехе. Если нужно уменьшить размер шрифта в таблице, в сгенерированном коде находим команду `\small` (она всегда в самом начале второй строки) и меняем на одну из следующих команд (отсортированы в порядке уменьшения): `\footnotesize`, `\scriptsize`, `\tiny`.

## Поля для ответов

### Обычные задачи

Для боксов с ответами используется команда `\answerbox{}`. Она принимает один аргумент --- высота бокса. Есть еще дополнительная команда --- `\Answerbox{}`, она нужна для разделения боксов на разные страницы. Если, к примеру, `\answerbox{10cm}` не хватает места на текущей странице, можно сначала создать `\answerbox{7cm}`, а потом дополнить `\Answerbox{3cm}`. Разница команд в том, что `\answerbox{}` автоматически считает и вставляет пункт задачи, для которого создается бокс, поэтому дополнительно нумерацию добавлять не нужно. `\Answerbox{}` просто создает бокс без нумерации, поэтому для разделения боксов на другие страницы нужно использовать именно эту команду.

Если задача разделена на подзадачи, надо использовать команду `\ansbox{}{}` вместо `\answerbox{}` (прошу прощения за такие плохие названия команд). Она принимает два аргумента: первый --- номер подзадачи и пункта (например, 1.1, без номера самой задачи), второй --- высота бокса. Если он не вмещается в одну страницу, надо использовать так же `\Answerbox{}`. Если для задачи хоть раз надо использовать `\ansbox{}{}`, все остальные боксы тоже надо создавать этой командой, потому что счетчик пунктов не будет работать.

### Задачи по органике

Если в задаче по органике нужна таблица, как на рисунке ниже, нужно использовать еще один репл.

![org-chem-table-blank](images/org-chem-table-blank.png)

Так же, переходим по [ссылке](https://replit.com/join/iyzsfhcylo-drmrmld), открываем файл `main.py` и редактируем только две переменной: `compounds` и `file`. Первая --- лист с названиями неизвестных органических соединений. Вторая переменная должна иметь значение `"Blank"`, если таблица нужна для бланка. Задаем лист с названиями неизвестных соединений и жмем "Run" (`Cmd/Ctrl+Enter`). В файле `org-chem-table.tex` будет код, который надо будет просто вставить в код латеха.

Но в этом случае нумерация не добавится, поэтому надо перед кодом с таблицей добавить команду `\problempart`.

# Файл с задачами

## Основной файл

### Преамбула

В преамбуле главные моменты: `\documentclass{qazcho_tasks}` --- относит данный файл к специальному классу со всеми нужными пакетами и командами, `\input{siunitx.cfg}` --- добавляет команды для перевода пакета `siunitx` на русский язык. В преамбуле ничего редактировать не надо.

### Титульный лист

Титульный лист создается командой `\titlepage{}{}{}{}`. Она принимает 4 аргумента: этап олимпиады, год, класс и название файла.

### Регламент, периодическая таблица, задачи

Сразу после титульного листа вставляется команда `\tableofcontents`, чтобы создалась страница с содержанием. Регламент и периодическая таблица находятся в отдельных файлах. Добавлять их надо с помощью команды `\include{}`, она будет вставлять их на новой странице. Задачи находятся в папке problems. Для каждой папки есть отдельная папка с названием задачи, это надо, чтобы можно было в этой папке создать папку images и хранить там изображения, нужные для конкретной задачи. В папке с названием задачи находится `.tex`-файл с названием задачи, его надо добавлять с помощью команды `\input{}`, чтобы для новой задачи не создавалась новая страница.

## Файл с самой задачей

### Название задачи

В начале `.tex`-файла надо прописывать команду `\problem{}{}`. Они принимает два аргумента: название задачи (без номера) и ее вес (без знака процента).

### Таблица с баллами

Таблица с баллами создается полностью так же, как и для бланков.

### Задачи с подзадачами

Если задача разделена на подзадачи, надо использовать команду `\subproblem{}`. В ее аргументе номер подзадачи писать надо. Пример:

```latex
\subproblem{Подзадача 1. Реакция второго порядка.}
```

### Таблицы в задаче

Для таблиц в задаче можно использовать стандартную среду (environment) `table`, но внутри нее надо использовать не стандартную среду `tabular`, а `tabularx`.

```latex
\begin{table}[H]
  \centering
  \begin{tabularx}{0.8\textwidth}{|Y|Y|Y|Y|}
    \hline
    $\omega (\mathbf{A})$ & $\omega (\mathbf{C})$ & $\omega (\mathbf{O})$ & $\omega (\mathbf{H})$ \\
    \hline
    26.28\% & 22.98\% & 45.92\% & 4.82\% \\
    \hline
  \end{tabularx}
\end{table}
```

После `\begin{table}` надо ставить `[H]`, чтобы таблица стояла строго в том порядке, в котором она указана в коде. В среду `tabularx` передаем два аргумента: ширина таблицы и вид ячеек. Используем `Y` если надо, чтобы ячейка выравнивалать по центру и `X` --- если надо выравнивание по левой стороне.

### Изображения в задаче

Изображения добавляются почти так же, как и всегда, просто используется `[H]`, чтобы изображение поместилось в порядке, указанном в коде.

```latex
\begin{figure}[H]
  \centering
  \includegraphics[width=\textwidth]{problems/problem4/images/image1}
\end{figure}
```

### Единицы измерения

Для единиц измерения используется пакет `siunitx`. Можно использовать команды `\qty{}{}` и `\unit{}` (можно использовать как внутри, так и вне math mode). Иногда вторая будет предпочтительнее, потому что так цифры будут выводиться не в стандартном шрифте латеха, а в PT Serif. Примеры использования:

```latex
Плотность воды равна $\rho = \qty{1000}{\kilo\gram\per\meter\cubed}$
Константа скорости равна $k_1 = \qty{0.0042}{\liter\per\mole\per\second}$

Плотность воды равна $\rho = 1000~\unit{\kilo\gram\per\meter\cubed}$
Константа скорости равна $k_1 = 0.0042~\unit{\liter\per\mole\per\second}$
```

Для удобства я создал сокращенные команды для часто используемых единиц измерения:

| Сокращенная команда | Полная команда | Вывод |
|---------------------|----------------|-------|
| `\lmols` | `\liter\per\mole\per\second`  | л моль<sup>-1</sup> с<sup>-1</sup>  |
| `\gcm`   | `\gram\per\centi\meter\cubed` | г см<sup>-3</sup>                   |
| `\kgm`   | `\kilo\gram\per\meter\cubed`  | кг м<sup>-3</sup>                   |
| `\jmol`  | `\joule\per\mole`             | Дж моль<sup>-1</sup>                |
| `\jmolk` | `\joule\per\mole\per\kelvin`  | Дж моль<sup>-1</sup> К<sup>-1</sup> |
| `\kjmol` | `\kilo\joule\per\mole`        | кДж моль<sup>-1</sup>               |
| `\mets`  | `\meter\per\second`           | м с<sup>-1</sup>                    |
| `\kmh`   | `\kilo\meter\per\hour`        | км ч<sup>-1</sup>                   |
| `\kpa`   | `\kilo\pascal`                | кПа                                 |
| `\mpa`   | `\mega\pascal`                | МПа                                 |
| `\moll`  | `\mole\per\liter`             | моль л<sup>-1</sup>                 |
| `\moldm` | `\mole\per\deci\meter\cubed`  | моль дм<sup>-3</sup>                |
| `\molls` | `\mole\per\liter\per\second`  | моль л<sup>-1</sup> с<sup>-1</sup>  |
| `\js`    | `\joule\per\second`           | Дж с<sup>-1</sup>                   |
| `\cmol`  | `\coulomb\per\mole`           | Кл моль<sup>-1</sup>                |
| `\gmol`  | `\gram\per\mole`              | г моль<sup>-1</sup>                 |
| `\kgmol` | `\kilo\gram\per\mole`         | кг моль<sup>-1</sup>                |

Тот же пример, но с сокращенными командами:

```latex
Плотность воды равна $\rho = \qty{1000}{\kgm}$
Константа скорости равна $k_1 = \qty{0.0042}{\lmols}$
```

Для дополнительной информации можно почитать [документацию пакета](https://ctan.org/pkg/siunitx).

### Химические формулы

Для химических формул используется пакет `mhchem`. Ознакомитсья с пакетом можно из [Chemistry Stack Exchange Meta](https://chemistry.meta.stackexchange.com/questions/86/faq-how-can-i-format-math-chemistry-expressions-on-chemistry-stack-exchange). Стоит заметить, что команды, которые используются на этом форуме для единиц измерения мы использовать не можем, пользоваться надо только командами `siunitx`. В принципе, знаний из этого поста более, чем достаточно, но на всякий случай оставлю ссылку на [документацию `mhchem`](https://www.ctan.org/pkg/mhchem).

В команде `\ce{}` нельзя использовать кириллицу, поэтому надо помещать ее в команду `\text{}`. Пример:

```latex
\begin{gather}
    \notag \ce{A ->[k] \text{продукты}} \\
    \label{eq:first-order-one-reag} v_1 = k \cdot [A] = - \frac{dA}{dt}
\end{gather}
```

### Листы

Часто после одного пункта задачи идет еще абзац или несколько, которые приводят ученика к следующему пункту задачи. Если открыть новую среду `enumerate`, счет начнется с 1. Это можно исправить, поставив счетчик на нужное значение. Пример кода для четвертого пункта задачи, который "оторвался" от предыдущих пунктов:

```latex
\begin{enumerate}
\setcounter{enumi}{3}
    \item Четверый пункт задачи.
\end{enumerate}
```

### Прочее

Для жирного текста можно использовать как `\textbf{}`, так и `\em{}`.

В примере конечного файла с задачами, в 4 задаче я поставил 7-й пункт рядом с изображением. Чтобы сделать такое, надо знать о среде `minipage`. Можно обойтись и без этого, но если кому-то захочется, оставлю ссылку на [туториал по `minipage`](https://latex-tutorial.com/minipage-latex/).

# Файл с решениями

## Основной файл

### Преамбула

Все так же, специальный класс `qazcho_sol` и перевод пакета `siunitx` на русский. Редактировать нет надобности.

### Титульный лист

Титульный лист создается командой `\titlepage{}{}{}{}`. Она принимает 4 аргумента: этап олимпиады, год, класс и название файла.

### Регламент, периодическая таблица, задачи

Полностью аналогично с файлом с задачами.

## Файл с самим решением

### Название задачи

Полностью аналогично с названиями задач в файле с задачами.

### Таблица с баллами

Полностью аналогично с таблицами с баллами из бланка.

### Боксы с решением

#### Обычные задачи

Для бокса с решением задачи используется среда `solbox`. В нее надо провести аргумент --- общее количество баллов за задачу.

Если задача разделена на подзадачи, вместо `solbox`, используется среда `Solbox`. В нее пропускается два аргумента: первый --- номер подзадачи и пункта (без указания номера задачи), второй --- общее количество баллов за задачу. Пример:

```latex
\begin{Solbox}{1.1}{7 баллов}
    Текст решения
\end{Solbox}
```

Если бокс с решением не помещается полностью на странице, надо закрыть среду `Solbox` и продолжить решение в новой среде `emptysolbox` (аналогия с командой `\Answerbox{}` для бланка).

Внутри этих боксов с решениями пишется код, как в обычном файле с задачей. Можно использовать те же скоращенные команды для единиц измерения, таблицы создаются так же, в среде `tabularx`, для химических формул все так же команды `mhchem`.

Единственное отличие --- внутри боксов с решением нельзя использовать среду `table`, потому что это float-элемент, поэтому при создании таблиц сразу надо открывать среду `tabularx` и создавать таблицу.

#### Задачи по органике

Для задач по органике надо сначала добавить нумерацию задачи. Можно и просто поставить `\textbf{1.1}`, например. Главное, поставить после него `\nopagebreak`, чтобы пункт задачи и таблица с соединениями были на одной странице.

После этого надо вставить таблицу, в которой будут соединения --- `.pdf`-файлы или файлы изображений (к сожалению, с форматом `.svg` возникают проблемы, но его можно сконвертировать в `.pdf`). Генерирование таблиц аналогично с генерированием таблиц для бланка, и репл тот же. Просто переменной `file` надо будет задать значение `"Solution"`. Полученный код надо вставить в нужное место в коде.

Но на этом не все, надо еще добавить изображения соединений. Для этого есть команда `\chemcompound{}` и в конечном коде с таблицей эти команды уже будут расставлены, останется только передать в них нужный аргумент --- полное название файла (то есть с путем к нему) с соединением[^2], в том же порядке, в каком и заполнялся лист `compounds` в файле с питоном.

Если таблица не вмещается полностью на одну страницу, надо просто разделить ее на две таблицы.

# Примечания

[^1]: Важные моменты: значения в листе разделять запятыми и писать обязательно в кавычках. Перед знаком "%" надо поставить "\", потому что иначе латех не так поймет код.
[^2]: Путь к файлу должен начинаться с основной папки с проектом, не с папки, в котором находится задача.